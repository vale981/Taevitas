#ifndef CAMERAMANAGER_H
#define CAMERAMANAGER_H


/* 
   This Class is an abstraction over the FlyCapture2 API for handeling the connection to the camera and 
   hiding the internals from the GUI code, to make reusability easier, although FlyCapture code is needed   outside.
*/

// TODO: Exclude inline Implementation

#include <QObject>
#include "FlyCapture2.h"

class CameraManager : public QObject
{
	Q_OBJECT
	
public:
	explicit CameraManager(QObject *parent = 0);
	~CameraManager();

	// Pointer to the last image captured by the camera //TODO maybe obsolete
	FlyCapture2::Image* lastImage;

	// Starts capturing images. When an image has been captured, the signal frameCaptured is emited.
	// Emits Error signal in case of an error.
	void startCapture();

	//TODO remove, if not needed
	FlyCapture2::Camera* getCamera() {
		return &camera;
	};

	bool isConnected() {
		return camera.IsConnected();
	}

	// Get the number of connected cameras.
	unsigned int numCameras() {
		bus_mgr.GetNumOfCameras(&num_cameras);
		return num_cameras;
	};

	// Connect camera from index. Once successfull it emits the cameraConnected signal.
	// Emits Error signal in case of an error.
	void connectCamera(unsigned int);

	
	
private:
	FlyCapture2::Camera camera;
	
	FlyCapture2::BusManager bus_mgr;
	unsigned int num_cameras;

	// GUID of the camera, which is currently being used
	FlyCapture2::PGRGuid camera_guid;

	// Just a littile wrapper function around the callback function for the camera capture to emit signals.
	static inline void captureCallback(FlyCapture2::Image*, const void*);
								     
private slots:
	
signals:
	void frameCaptured(FlyCapture2::Image*) const;
	void cameraConnected(FlyCapture2::Camera*);
	
	//Error signal
	void camError(FlyCapture2::Error);
};

#endif // CAMERAMANAGER_H

